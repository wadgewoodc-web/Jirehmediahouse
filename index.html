<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Inside <head> -->
<style>
  .logo-img {
    height: 42px;
    width: auto;
    border-radius: 8px;
    box-shadow: 0 0 12px rgba(0,212,255,0.3);
    transition: transform 0.3s ease;
  }
  .logo-img:hover {
    transform: scale(1.05);
  }
</style>

  <meta charset="UTF-8" />
  <title>Jireh Media House ‚Äî Stories that move people</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Jireh Media House: premium media production, comprehensive branding, professional printing, and practical computer lessons in Kampala, Uganda." />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap">
  <style>
    /* -------- Global Reset & Variables (Professional) -------- */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { margin: 0; padding: 0; scroll-behavior: smooth; }
    body {
      font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
      background: var(--bg); color: var(--text); min-height: 100vh;
      transition: background 0.3s ease, color 0.3s ease; /* Smooth mode switch */
      line-height: 1.6;
    }

    /* Core Theme Variables */
    :root{
      --bg: #0f1217;       /* Deep Night Blue */
      --bg-soft: #131722;  /* Slightly Lighter Background */
      --card: #171b28;     /* Dark Card Background */
      --text: #eaf1ff;     /* Off-White Text */
      --muted: #a9b6c8;    /* Muted Grey Text */
      --primary: #00d4ff;  /* Neon Cyan (The 'Jireh' color) */
      --accent: #ff5b8f;   /* Pink/Magenta Accent */
      --success: #27d17f;  /* Green for success */
      --danger: #ff6b6b;   /* Red for danger */
      --border: rgba(255,255,255,0.08); /* Subtle White Border */
      --shadow: rgba(0,0,0,0.45); /* Dark Shadow */
      --radius: 12px;
    }
    .light {
      --bg: #f6f9ff;
      --bg-soft: #ffffff;
      --card: #ffffff;
      --text: #0f1217;
      --muted: #4b5563;
      --border: rgba(0,0,0,0.12);
      --shadow: rgba(0,0,0,0.15);
    }

    /* -------- Professional Animations (Eye-Catching) -------- */
    /* Scroll Reveal Animation */
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }

    .animate-in { animation: slideUp 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; opacity: 0; }
    .animate-delay-1 { animation-delay: 0.1s; }
    .animate-delay-2 { animation-delay: 0.2s; }
    .animate-delay-3 { animation-delay: 0.3s; }

    /* Logo Pulse */
    @keyframes glowPulse {
      0%, 100% { box-shadow: 0 0 10px rgba(0,212,255,0.2), 0 0 20px rgba(255,91,143,0.15); }
      50% { box-shadow: 0 0 25px rgba(0,212,255,0.5), 0 0 40px rgba(255,91,143,0.3); }
    }

    /* -------- Layout & Structure -------- */
    header {
      position: sticky; top: 0; z-index: 1000;
      backdrop-filter: blur(10px);
      background: var(--bg-soft, 0.9); /* Use a slight transparency for the sticky effect */
      border-bottom: 1px solid var(--border);
    }
    .nav {
      display: flex; align-items: center; justify-content: space-between;
      gap: 10px; max-width: 1280px; margin: 0 auto; padding: 14px 20px;
    }
    .brand { display: flex; align-items: center; gap: 10px; font-weight: 800; font-size: 1.25rem; }
    .brand-badge {
      width: 38px; height: 38px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, var(--primary), var(--accent));
      animation: glowPulse 4s ease-in-out infinite alternate;
      border: 2px solid var(--primary); /* More pronounced border */
    }
    .nav-links { display: flex; flex-wrap: wrap; gap: 4px; }
    .nav-links a, .nav-links button {
      padding: 10px 14px; border-radius: 8px; border: none; background: transparent;
      color: var(--text); cursor: pointer; transition: all .3s ease; text-decoration: none;
      font-weight: 500;
    }
    .nav-links a:hover, .nav-links button:hover { background: rgba(0, 212, 255, 0.1); color: var(--primary); }

    section { padding: 80px 20px; }
    .container { max-width: 1280px; margin: 0 auto; }

    .section-title { font-size: clamp(2rem, 5vw, 3rem); font-weight: 900; margin-bottom: 16px; color: var(--text); }
    .section-subtitle { color: var(--primary); font-size: 1.1rem; font-weight: 600; margin-bottom: 8px;}
    .muted { color: var(--muted); }

    /* -------- Buttons & Inputs (Modern) -------- */
    .btn {
      padding: 12px 20px; border-radius: 10px; border: 1px solid var(--border);
      background: var(--card); color: var(--text); cursor: pointer;
      transition: all .3s ease; font-weight: 600; text-decoration: none;
      display: inline-flex; align-items: center; justify-content: center;
    }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
    .btn-primary {
      background: linear-gradient(90deg, var(--primary), var(--accent));
      background-size: 200% 200%;
      border-color: transparent; color: var(--bg);
    }
    .btn-primary:hover {
      background-position: 100% 50%;
      box-shadow: 0 0 20px rgba(0,212,255,0.4);
    }
    .btn-accent {
      background: transparent; border-color: var(--accent); color: var(--accent);
    }
    .btn-accent:hover {
      background: rgba(255,91,143,0.1);
      transform: translateY(-3px);
    }

    .input, .select, textarea {
      width: 100%; padding: 12px; border-radius: 10px; border: 1px solid var(--border);
      background: var(--bg-soft); color: var(--text);
      transition: border-color 0.3s ease;
    }
    .input:focus, .select:focus, textarea:focus { border-color: var(--primary); outline: none; }
    .input::placeholder, textarea::placeholder { color: var(--muted); }

    /* -------- Hero (Visual Impact) -------- */
    .hero {
      position: relative; min-height: 80vh; display: grid; place-items: center; overflow: hidden;
      /* Subtle animated gradient background */
      background:
        radial-gradient(1200px 400px at 8% 12%, rgba(0,212,255,0.18), transparent 65%),
        radial-gradient(1000px 350px at 90% 20%, rgba(255,91,143,0.15), transparent 65%),
        linear-gradient(180deg, var(--bg), var(--bg-soft));
    }
    .hero-content { max-width: 1000px; padding: 40px 20px; text-align: center; }
    .hero h1 {
      font-size: clamp(3rem, 8vw, 6rem); line-height: 1.1; margin: 0 0 16px;
      /* Neon Gradient Text */
      background: linear-gradient(90deg, var(--primary), #80ffea, var(--accent));
      -webkit-background-clip: text; background-clip: text; color: transparent;
      animation: fadeIn 1.2s ease forwards;
    }
    .hero-content p { font-size: 1.25rem; margin-bottom: 30px; }
    .cta-row { display: flex; gap: 14px; justify-content: center; flex-wrap: wrap; animation: fadeIn 1.2s ease 0.3s forwards; opacity: 0;}

    /* -------- Cards & Grids (Scroll Reveal) -------- */
    .grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;
    }
    .two-col { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
    @media (max-width: 1000px){ .two-col { grid-template-columns: 1fr; } }

    .card {
      background: var(--card);
      border: 1px solid var(--border); border-radius: var(--radius); overflow: hidden;
      transition: transform .3s ease, box-shadow .3s ease, border-color .3s ease;
      position: relative;
    }
    .card:hover { transform: translateY(-5px); box-shadow: 0 18px 40px var(--shadow); border-color: var(--primary); }
    .card-media { height: 180px; background: var(--bg-soft); display: grid; place-items: center; overflow: hidden; }
    .card-media img, .card-media video { width: 100%; height: 100%; object-fit: cover; }
    .card-body { padding: 18px; }

    .price { color: var(--success); font-weight: 700; font-size: 1.2rem; }
    .badge { font-size: 12px; padding: 4px 8px; border: 1px solid var(--border); border-radius: 8px; color: var(--muted); background: var(--bg-soft); }
    .badge-primary { color: var(--primary); border-color: var(--primary); }
    .badge-accent { color: var(--accent); border-color: var(--accent); }

    /* -------- Testimonials (Slicker Carousel) -------- */
    .carousel {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;
    }
    .carousel-item {
      padding: 20px; border: 1px solid var(--border); border-radius: 12px; background: var(--card);
      border-left: 5px solid var(--primary); /* Visual accent line */
    }
    .carousel-item blockquote { margin: 0; font-style: italic; color: var(--muted); }
    .carousel-item footer { margin-top: 10px; font-weight: 600; color: var(--text); }

    /* -------- Contact & Forms -------- */
    .contact-info { background: var(--card); border-left: 5px solid var(--accent); }
    .row { display: flex; gap: 12px; margin-bottom: 12px; }
    .row > * { flex: 1; }

    /* -------- Admin Modal (Visual Separation) -------- */
    .modal-backdrop { transition: opacity 0.3s ease; }
    .modal {
      display: grid; grid-template-columns: 280px 1fr; min-height: 80vh;
      box-shadow: 0 20px 50px rgba(0,0,0,0.8);
    }
    .admin-sidebar {
      background: var(--bg-soft); border-right: 1px solid var(--border); padding: 18px;
    }
    .sidebar-link {
      padding: 10px 14px; border-radius: 8px;
    }
    .sidebar-link.active { border-color: var(--primary); background: rgba(0,212,255,0.15); color: var(--primary); }

    /* -------- Footer -------- */
    footer { padding: 50px 20px; border-top: 1px solid var(--border); background: var(--bg-soft); }
    .footer-inner { max-width: 1280px; margin: 0 auto; display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
    .foot-links { display: flex; gap: 15px; flex-wrap: wrap; }
    .foot-links a { text-decoration: none; color: var(--muted); transition: color 0.3s ease; }
    .foot-links a:hover { color: var(--primary); }

    @media (max-width: 800px){
      .nav-links { display: none; } /* Hide for mobile to keep clean, would use a mobile menu in production */
      .hero { min-height: 60vh; padding-top: 100px; }
      .modal { grid-template-columns: 1fr; }
      .admin-sidebar { display: none; } /* Simplified mobile admin */
      .footer-inner { grid-template-columns: 1fr; }
      .row { flex-direction: column; }
    }
    .hide { display: none !important; }
  </style>
</head>
<body class="dark">
	
  <!-- Inside <body> -->
<header>
  <nav class="nav">
    <div class="brand">
      <img src="jireh logo-new.jpg" alt="Jireh Photography & Graphics Logo" width="3566" class="logo-img" />
      <span>Jireh Media House</span>
    </div>
    <div class="nav-links">
      <a href="#home">Home</a>
      <a href="#services">Services</a>
      <a href="#portfolio">Portfolio</a>
      <a href="#lessons">Lessons</a>
      <a href="#contact">Contact</a>
      <button id="adminBtn" class="btn btn-accent">Admin</button>
      <button id="modeToggle" class="btn">üåô/‚òÄÔ∏è</button>
    </div>
  </nav>
</header>

  <section id="home" class="hero">
    <div class="hero-content">
      <h1 class="animate-in">Stories that **Move People**</h1>
      <p class="muted animate-in animate-delay-1">Media production, comprehensive branding, professional printing, and practical computer lessons ‚Äî from Kampala to the world.</p>
      <div class="cta-row">
        <a href="#services" class="btn btn-primary animate-in animate-delay-2">Explore Services &rarr;</a>
        <a href="#portfolio" class="btn btn-accent animate-in animate-delay-3">View Portfolio</a>
      </div>
    </div>
  </section>

  <section id="services">
    <div class="container">
      <p class="section-subtitle animate-in">WHAT WE OFFER</p>
      <h2 class="section-title animate-in animate-delay-1">Full-Spectrum Media & IT Solutions</h2>
      <div class="grid" id="servicesGrid"></div>
    </div>
  </section>

  <section id="portfolio">
    <div class="container">
      <p class="section-subtitle animate-in">OUR WORK</p>
      <h2 class="section-title animate-in animate-delay-1">Selected Projects</h2>
      <div class="grid" id="portfolioGrid"></div>
      <div style="text-align:center; margin-top: 40px;" class="animate-in animate-delay-2">
         <a href="#contact" class="btn btn-primary">Start Your Project Today</a>
      </div>
    </div>
  </section>

  <section id="lessons">
    <div class="container">
      <p class="section-subtitle animate-in">UPSKILL NOW</p>
      <h2 class="section-title animate-in animate-delay-1">Hands-On Computer Lessons</h2>
      <div class="two-col">
        <div>
          <p class="muted animate-in animate-delay-2">Learn practical, job-ready skills in a modern, supportive environment. Choose from our intensive courses in Basic IT, Microsoft Office, Web Design, Programming, and Video Editing.</p>
          <div id="lessonsGrid" class="grid" style="margin-top:20px;"></div>
        </div>
        <div class="card animate-in animate-delay-3">
          <div class="card-body">
            <h3>&#9997; Register for a Course</h3>
            <p class="muted">Secure your spot and transform your career.</p>
            <div class="row">
              <input id="regName" class="input" placeholder="Your name" required />
              <input id="regEmail" class="input" placeholder="Your email" type="email" required />
            </div>
            <select id="regCourse" class="select" required></select>
            <textarea id="regMsg" class="input" style="margin-top:12px; height: 80px;" placeholder="What are your goals? (optional)"></textarea>
            <div style="margin-top:12px;">
              <button class="btn btn-primary" onclick="submitRegistration()">Submit Registration</button>
            </div>
            <p id="regStatus" class="muted" style="margin-top:8px; font-weight: 600;"></p>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section id="testimonials">
    <div class="container">
      <p class="section-subtitle animate-in">TRUSTED PARTNER</p>
      <h2 class="section-title animate-in animate-delay-1">What Our Clients Say</h2>
      <div class="carousel" id="testimonialCarousel"></div>
    </div>
  </section>

  <section id="catalog">
    <div class="container">
      <p class="section-subtitle animate-in">EXPLORE</p>
      <h2 class="section-title animate-in animate-delay-1">Media & Product Catalog</h2>
      <div class="row animate-in animate-delay-2" style="margin-bottom:20px;">
        <input id="searchInput" class="input" placeholder="Search services, products, or media..." />
        <select id="categorySelect" class="select" style="max-width:200px;">
          <option value="">All Categories</option>
          <option value="service">Service</option>
          <option value="product">Product</option>
          <option value="media">Media</option>
        </select>
        <button id="clearSearch" class="btn">Clear</button>
      </div>
      <div id="catalogGrid" class="grid"></div>
    </div>
  </section>

  <section id="contact">
    <div class="container">
      <p class="section-subtitle animate-in">GET IN TOUCH</p>
      <h2 class="section-title animate-in animate-delay-1">Let's Create Together</h2>
      <div class="two-col" style="margin-top: 30px;">
        <div class="card animate-in animate-delay-2">
          <div class="card-body">
            <h3>&#9993; Send a Project Inquiry</h3>
            <p class="muted">Tell us about your vision. We'll respond within 24 hours.</p>
            <div class="row">
              <input id="contactName" class="input" placeholder="Your name" required />
              <input id="contactEmail" class="input" placeholder="Your email" type="email" required />
            </div>
            <textarea id="contactMsg" class="input" style="height: 120px;" placeholder="Project scope, budget, and timeline." required></textarea>
            <div style="margin-top:12px;"><button class="btn btn-primary" onclick="fakeSubmit()">Send Inquiry</button></div>
            <p id="contactStatus" class="muted" style="margin-top:8px;"></p>
          </div>
        </div>
        <div class="card contact-info animate-in animate-delay-3">
          <div class="card-body">
            <h3>&#128205; Visit & Connect</h3>
            <p><strong>Location:</strong> Kampala, Central Region, Uganda</p>
            <p><strong>Hours:</strong> Mon‚ÄìSat: 9:00‚Äì18:00 EAT</p>
            <p style="margin-top:20px;"><strong>Connect with us:</strong></p>
            <div class="foot-links">
              <a href="#" class="badge badge-primary">Facebook</a>
              <a href="#" class="badge badge-accent">Instagram</a>
              <a href="#" class="badge">YouTube</a>
              <a href="#" class="badge">LinkedIn</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div id="adminModal" class="modal-backdrop hide" onclick="if(event.target === this) closeAdmin()">
    <div class="modal">
      <aside class="admin-sidebar">
        <p class="sidebar-section-title">ADMIN TOOLS</p>
        <button class="sidebar-link active" data-view="dashboard">Dashboard</button>
        <button class="sidebar-link" data-view="products">Content Manager</button>
        <button class="sidebar-link" data-view="sales">Registrations & Sales</button>
        <button class="sidebar-link" data-view="calculator">Quotation Calculator</button>
        <button class="sidebar-link" data-view="security">Security</button>
        <p class="sidebar-section-title" style="margin-top:15px;">DATA</p>
        <button class="sidebar-link" data-view="settings">Settings & Import/Export</button>
        <button class="btn btn-danger" onclick="logout()" style="margin-top:20px;">Logout</button>
      </aside>

      <div>
        <div class="admin-topbar">
          <strong>Jireh Admin Panel</strong>
          <div class="inline">
            <span id="sessionStatus" class="badge">Logged out</span>
            <button class="btn" onclick="closeAdmin()">Close</button>
          </div>
        </div>

        <div id="loginGate" class="admin-content fade-up">
          <p class="muted">Enter your credentials to access the dashboard.</p>
          <div class="row">
            <input id="adminUser" class="input" placeholder="Username" />
            <input id="adminPass" class="input" placeholder="Password" type="password" />
          </div>
          <div class="row">
            <input id="adminOtp" class="input" placeholder="Admin PIN (optional second factor)" />
            <button class="btn btn-primary" onclick="adminLogin()">Login</button>
          </div>
          <p id="loginMsg" class="danger" style="margin-top:10px;"></p>
        </div>

        <div id="adminViews" class="admin-content hide">
          <div id="view-dashboard" class="hide">
            <h3>Overview</h3>
            <div class="grid">
              <div class="card"><div class="card-body"><strong>Total Catalog Items</strong><p id="statItems" class="muted"></p></div></div>
              <div class="card"><div class="card-body"><strong>Lifetime Sales Value</strong><p id="statSales" class="muted success"></p></div></div>
              <div class="card"><div class="card-body"><strong>New Registrations</strong><p id="statRegs" class="muted"></p></div></div>
              <div class="card"><div class="card-body"><strong>Last Login</strong><p id="statLastLogin" class="muted"></p></div></div>
            </div>
            <p class="muted" style="margin-top:15px;">Recent Activity Log</p>
            <div id="auditLog" class="grid" style="grid-template-columns: 1fr; gap: 8px;"></div>
          </div>

          <div id="view-products" class="hide">
            <h3>Content Manager: Services, Portfolio, Blog & FAQ</h3>
            <p class="muted">Add/Edit Content. **Note:** All content types (services, portfolio, blog, lessons) are managed as 'Items' in this simulation for simplicity.</p>
            <div class="row">
              <input id="prodName" class="input" placeholder="Title/Name" />
              <input id="prodPrice" class="input" placeholder="Price (UGX, 0 if N/A)" type="number" min="0" />
            </div>
            <div class="row">
              <select id="prodCategory" class="select">
                <option value="service">Service</option>
                <option value="product">Product</option>
                <option value="portfolio">Portfolio</option>
                <option value="lesson">Lesson</option>
                <option value="blog">Blog</option>
                <option value="faq">FAQ</option>
                <option value="testimonial">Testimonial</option>
              </select>
              <input id="prodMediaUrl" class="input" placeholder="Media/Image URL (optional)" />
            </div>
            <textarea id="prodDesc" class="input" style="margin-top:10px; height: 80px;" placeholder="Description, Excerpt, or Quote..."></textarea>
            <div class="row" style="margin-top:10px;">
              <button class="btn btn-primary" onclick="addOrUpdateProduct()">Save / Update Content</button>
              <button class="btn" onclick="resetProductForm()">Clear Form</button>
            </div>
            <div style="margin-top:20px;">
              <h4>Current Inventory & Content (Click to Edit)</h4>
              <div id="adminInventory" class="grid"></div>
            </div>
          </div>

          <div id="view-sales" class="hide">
            <h3>Client Registrations & Sales</h3>

            <h4>New Lesson Registrations</h4>
            <div id="regsList" class="grid" style="grid-template-columns: 1fr; gap: 10px;"></div>
            <p id="regsStatus" style="margin-top:8px;" class="muted"></p>

            <h4 style="margin-top:20px;">Record Sale</h4>
            <div class="row">
              <select id="saleItem" class="select"></select>
              <input id="saleQty" class="input" type="number" min="1" placeholder="Quantity" />
            </div>
            <div class="row">
              <button class="btn btn-primary" onclick="recordSale()">Record Sale</button>
              <button class="btn" onclick="clearSales()">Clear Sales History</button>
            </div>
            <div class="card" style="margin-top:15px;">
              <div class="card-body">
                <h4>Sales History</h4>
                <div id="salesList" class="grid" style="grid-template-columns: 1fr; gap: 8px;"></div>
                <p id="salesTotals" style="margin-top:8px;" class="muted"></p>
              </div>
            </div>
          </div>

          <div id="view-calculator" class="hide">
            <h3>Quotation Calculator (UGX)</h3>
            <p class="muted">Generate quick estimates for clients.</p>
            <div class="calc-actions" style="margin-bottom:10px;">
              <button class="btn btn-primary" onclick="calcAddRow()">+ Add Line Item</button>
              <button class="btn" onclick="calcClear()">Clear All</button>
              <span id="calcMsg" class="muted"></span>
            </div>
            <table class="table" id="calcTable">
              <thead>
                <tr>
                  <th>Item Description</th>
                  <th>Unit Price (UGX)</th>
                  <th>Qty</th>
                  <th>Disc (%)</th>
                  <th>Tax (%)</th>
                  <th>Line Total (UGX)</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody></tbody>
              <tfoot>
                <tr><td colspan="5">Subtotal</td><td id="calcSubtotal">0</td><td></td></tr>
                <tr><td colspan="5">Total Discount</td><td id="calcTotalDisc" class="danger">0</td><td></td></tr>
                <tr><td colspan="5">Total Tax</td><td id="calcTotalTax" class="primary">0</td><td></td></tr>
                <tr><td colspan="5"><strong>GRAND TOTAL DUE</strong></td><td id="calcGrand" class="success">0</td><td></td></tr>
              </tfoot>
            </table>
          </div>

          <div id="view-security" class="hide">
            <h3>Admin Security (Client-Side Simulation)</h3>
            <p class="muted">Change credentials. **Warning:** This is not production-grade security.</p>
            <div class="row">
              <input id="newUsername" class="input" placeholder="New admin username" />
              <input id="newPassword" class="input" type="password" placeholder="New admin password" />
            </div>
            <div class="row">
              <input id="newPin" class="input" placeholder="Admin PIN (optional 2FA-like factor)" />
              <button class="btn btn-primary" onclick="updateCredentials()">Update Credentials</button>
            </div>
            <p class="muted" style="margin-top:15px;">Current Security Status: <span id="secStatus" class="success">Hashed & Protected</span></p>
            <button class="btn btn-danger" onclick="wipeSession()" style="margin-top:10px;">Wipe Session & Data</button>
          </div>

          <div id="view-settings" class="hide">
            <h3>Data Management</h3>
            <p class="muted">Export/Import current application state to a local file.</p>
            <div class="row">
              <button class="btn" onclick="exportData()">&#128190; Export Data</button>
              <input type="file" id="importFile" accept=".json" style="flex:1;" />
              <button class="btn" onclick="importData()">&#128193; Import Data</button>
            </div>
            <p class="danger" style="margin-top:20px;">**DANGEROUS ZONE**</p>
            <button class="btn btn-danger" onclick="clearAllData()">&#10006; Clear ALL Local Data</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <footer>
    <div class="footer-inner">
      <div>
        <strong>Jireh Media House</strong>
        <p class="muted">Stories that move people. Excellence in Media, Branding, and IT Education.</p>
        <p class="muted" style="font-size:0.9rem; margin-top: 15px;">&copy; <span id="currentYear">2024</span> Jireh Media House. All rights reserved.</p>
      </div>
      <div class="foot-links">
        <a href="#home">Home</a>
        <a href="#services">Services</a>
        <a href="#portfolio">Portfolio</a>
        <a href="#lessons">Lessons</a>
        <a href="#contact">Contact</a>
        <a href="#" id="footerAdmin">Admin</a>
        <a href="#">Privacy Policy</a>
      </div>
    </div>
  </footer>

  <script>
    // Get current year for footer
    document.getElementById('currentYear').textContent = new Date().getFullYear();

    // ---------- Helpers (Enhanced) ----------
    function id(){ return 'id_' + Math.random().toString(36).slice(2) + Date.now().toString(36); }
    function formatUGX(n){
      if (typeof n !== 'number' || isNaN(n)) n = 0;
      return 'UGX ' + Math.round(n).toLocaleString('en-UG');
    }
    function nowISO(){ return new Date().toISOString(); }
    // Very simple client-side SHA-256 simulation (for credential hashing only)
    async function sha256(message) {
      const msgBuffer = new TextEncoder().encode(message);
      const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
      return hashHex;
    }

    // ---------- Seed content (Centralized Data) ----------
    const seed = {
      heroTagline: 'Media production, comprehensive branding, professional printing, and practical computer lessons ‚Äî from Kampala to the world.',
      items: [
        { id: id(), name: 'Video Production: Documentary', price: 4500000, category: 'service', desc: 'Full-scale documentary production.', mediaUrl: '' },
        { id: id(), name: 'Brand Identity & Logo Design', price: 1800000, category: 'service', desc: 'Comprehensive brand guide and logo suite.', mediaUrl: '' },
        { id: id(), name: 'T-Shirt Branding (Bulk)', price: 15000, category: 'product', desc: 'Per unit, includes printing.', mediaUrl: '' },
        { id: id(), name: 'Studio Photography Session', price: 300000, category: 'service', desc: 'Professional portrait or product shoot.', mediaUrl: '' },
        { id: id(), name: 'Web Design Foundations', price: 350000, category: 'lesson', duration: '5 weeks', outcomes: 'HTML/CSS basics, responsive design.', mediaUrl: '' },
        { id: id(), name: 'Event Highlight Reel', price: 0, category: 'portfolio', desc: 'Showreel from a major Kampala event.', mediaUrl: '' },
        { id: id(), name: '5 tips for better brand videos', price: 0, category: 'blog', excerpt: 'From scripting to lighting, here‚Äôs how to boost engagement.' },
        { id: id(), name: 'Why practical computer lessons matter', price: 0, category: 'blog', excerpt: 'Skills that translate directly into jobs.' },
        { id: id(), name: 'Professional and creative ‚Äî our campaign stood out!', price: 0, category: 'testimonial', desc: 'Aisha K.' },
        { id: id(), name: 'They handled everything from shoot to final cut.', price: 0, category: 'testimonial', desc: 'Studio J.' },
      ],
    };

    // Grouping functions for cleaner state management
    function getItemsByCategory(category){
        if(category === 'service' || category === 'product') return state.items.filter(i => i.category === 'service' || i.category === 'product');
        if(category === 'portfolio') return state.items.filter(i => i.category === 'portfolio');
        if(category === 'lesson') return state.items.filter(i => i.category === 'lesson');
        if(category === 'blog') return state.items.filter(i => i.category === 'blog');
        if(category === 'testimonial') return state.items.filter(i => i.category === 'testimonial');
        return [];
    }
    // Simplifies the seed data into one 'items' array.

    // ---------- State Management (Local Storage) ----------
    const LS_KEY = 'jireh_media_site_secure_v2';
    let state = {
      items: seed.items.slice(),
      sales: [], // {id, itemId, name, qty, unitPrice, total, time}
      regs: [], // lesson registrations: {id, name, email, course, msg, time}
      security: {
        usernameHash: null,
        passwordHash: null,
        pinHash: null,
        failedCount: 0,
        lockUntil: 0,
        lastLoginAt: null,
      },
      session: { token: null, expiresAt: 0 },
      audit: [] // {time, action, meta}
    };

    function loadState() {
      try {
        const stored = localStorage.getItem(LS_KEY);
        if (stored) {
          const loadedState = JSON.parse(stored);
          // Merge loaded state over initial state, preserving functions/defaults not in LS
          state = { ...state, ...loadedState };
          // Apply Dark/Light mode if stored
          if (loadedState.darkMode !== false) { // Default to dark mode if not explicitly false
             document.body.classList.add('dark');
          } else {
             document.body.classList.remove('dark');
             document.body.classList.add('light');
          }
        }
      } catch (e) { console.error('Error loading state:', e); }
    }

    function saveState() {
      state.darkMode = document.body.classList.contains('dark');
      try {
        localStorage.setItem(LS_KEY, JSON.stringify(state));
      } catch (e) { console.error('Error saving state:', e); }
    }

    async function ensureDefaultCredentials() {
      if (!state.security.usernameHash) {
        state.security.usernameHash = await sha256('admin');
        state.security.passwordHash = await sha256('admin');
        saveState();
      }
    }

    // ---------- Scroll Reveal Intersection Observer (Eye-catching Animation) ----------
    function setupScrollReveal() {
      const observer = new IntersectionObserver((entries, obs) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate-in');
            obs.unobserve(entry.target);
          }
        });
      }, {
        threshold: 0.1, // Trigger when 10% of the element is visible
      });

      // Target all relevant elements
      document.querySelectorAll('.section-subtitle, .section-title, .grid, .carousel-item, .card, .two-col > div > .muted, .row, .btn, .input').forEach(el => {
        // Only target elements that are not already part of the initial Hero animation
        if (!el.classList.contains('animate-in')) {
            el.classList.add('scroll-reveal'); // Add a class to target them initially
            el.classList.remove('animate-in'); // Ensure the initial class isn't there
            observer.observe(el);
        }
      });
    }

    // ---------- UI Rendering Functions ----------
    function renderCard(item, delay=0) {
      const isLesson = item.category === 'lesson';
      const isPortfolio = item.category === 'portfolio';
      const isBlog = item.category === 'blog';

      let badges = '';
      if(isLesson) badges = `<span class="badge badge-primary">${item.duration || 'Course'}</span>`;
      if(isPortfolio) badges = `<span class="badge badge-accent">Case Study</span>`;
      if(isBlog) badges = `<span class="badge">Blog Post</span>`;

      return `
        <div class="card scroll-reveal" style="animation-delay: ${delay * 0.1}s;">
          <div class="card-media">
            ${item.mediaUrl ? `<img src="${item.mediaUrl}" alt="${item.name}">` : `<span style="color:var(--muted);">${item.category.toUpperCase()} VISUAL</span>`}
          </div>
          <div class="card-body">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 8px;">
                <h4 style="margin:0;">${item.name}</h4>
                ${badges}
            </div>
            <p class="muted" style="font-size:0.9rem;">${item.desc || item.excerpt || item.outcomes || item.name}</p>
            ${item.price > 0 ? `<div class="price">${formatUGX(item.price)}</div>` : ''}
            ${isLesson ? `<button class="btn btn-accent" onclick="document.getElementById('regCourse').value='${item.name}'; document.getElementById('lessons').scrollIntoView();">Enroll</button>` : ''}
          </div>
        </div>
      `;
    }

    function renderServices() {
      const services = state.items.filter(i => i.category === 'service' || i.category === 'product');
      const html = services.map((s, i) => renderCard(s, i)).join('');
      document.getElementById('servicesGrid').innerHTML = html;
    }

    function renderPortfolio() {
      const portfolio = state.items.filter(i => i.category === 'portfolio').slice(0, 4);
      const html = portfolio.map((p, i) => renderCard(p, i)).join('');
      document.getElementById('portfolioGrid').innerHTML = html;
    }

    function renderTestimonials() {
      const testimonials = state.items.filter(i => i.category === 'testimonial');
      const html = testimonials.map((t, i) => `
        <div class="carousel-item scroll-reveal" style="animation-delay: ${i * 0.1}s;">
          <blockquote>"${t.name}"</blockquote>
          <footer>‚Äî ${t.desc}</footer>
        </div>
      `).join('');
      document.getElementById('testimonialCarousel').innerHTML = html;
    }

    function renderLessons() {
        const lessons = state.items.filter(i => i.category === 'lesson');
        const gridHtml = lessons.map((l, i) => renderCard(l, i)).join('');
        document.getElementById('lessonsGrid').innerHTML = gridHtml;

        // Populate course registration dropdown
        const select = document.getElementById('regCourse');
        select.innerHTML = '<option value="" disabled selected>Select a Course</option>' + lessons.map(l => `<option value="${l.name}">${l.name} - ${formatUGX(l.price)}</option>`).join('');
    }

    function renderCatalog() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const category = document.getElementById('categorySelect').value;
      const grid = document.getElementById('catalogGrid');

      const filteredItems = state.items.filter(item => {
        const matchesSearch = item.name.toLowerCase().includes(search) || (item.desc && item.desc.toLowerCase().includes(search));
        const matchesCategory = !category || item.category === category || (category === 'media' && (item.category === 'portfolio' || item.category === 'blog'));
        return matchesSearch && matchesCategory;
      }).filter(i => i.category !== 'testimonial' && i.category !== 'lesson'); // Exclude featured content

      const html = filteredItems.map((item, i) => renderCard(item, i)).join('');
      grid.innerHTML = html || '<p class="muted" style="padding: 20px;">No items match your search criteria.</p>';
    }

    // ---------- Form Submission Simulations ----------
    function submitRegistration() {
      const name = document.getElementById('regName').value;
      const email = document.getElementById('regEmail').value;
      const course = document.getElementById('regCourse').value;
      const msg = document.getElementById('regMsg').value;
      const statusEl = document.getElementById('regStatus');

      if (!name || !email || !course) {
        statusEl.textContent = 'Please fill in all required fields.';
        statusEl.classList.add('danger');
        return;
      }

      const newReg = { id: id(), name, email, course, msg, time: nowISO() };
      state.regs.push(newReg);
      saveState();

      statusEl.textContent = `‚úÖ Thank you, ${name}! Your registration for ${course} is received. We'll be in touch.`;
      statusEl.classList.remove('danger');
      statusEl.classList.add('success');

      // Clear form
      document.getElementById('regName').value = '';
      document.getElementById('regEmail').value = '';
      document.getElementById('regCourse').value = '';
      document.getElementById('regMsg').value = '';
    }

    function fakeSubmit() {
        const statusEl = document.getElementById('contactStatus');
        const name = document.getElementById('contactName').value;
        if (!name) {
            statusEl.textContent = 'Please enter your name.';
            statusEl.classList.add('danger');
            statusEl.classList.remove('success');
            return;
        }
        // Simulate a successful form submission
        statusEl.textContent = `‚úÖ Inquiry sent! Thank you, ${name}. We'll respond shortly.`;
        statusEl.classList.remove('danger');
        statusEl.classList.add('success');

        // Clear form
        document.getElementById('contactName').value = '';
        document.getElementById('contactEmail').value = '';
        document.getElementById('contactMsg').value = '';
    }


    // ---------- Admin Panel Logic (Simulated) ----------
    function isSessionValid() {
      return state.session.token && state.session.expiresAt > Date.now();
    }

    function openAdmin(){
      document.getElementById('adminModal').classList.remove('hide');
      if (!isSessionValid()){
        showLoginGate('');
      } else {
        showAdminViews();
        switchView('dashboard');
      }
    }
    function closeAdmin(){ document.getElementById('adminModal').classList.add('hide'); }

    function showLoginGate(msg) {
      document.getElementById('loginGate').classList.remove('hide');
      document.getElementById('adminViews').classList.add('hide');
      document.getElementById('sessionStatus').textContent = 'Logged out';
      document.getElementById('loginMsg').textContent = msg;
    }

    function showAdminViews() {
      document.getElementById('loginGate').classList.add('hide');
      document.getElementById('adminViews').classList.remove('hide');
      document.getElementById('sessionStatus').textContent = 'Active';
    }

    function switchView(view) {
      if (!isSessionValid()) return;
      document.querySelectorAll('#adminViews > div').forEach(el => el.classList.add('hide'));
      document.getElementById(`view-${view}`).classList.remove('hide');
      document.querySelectorAll('.admin-sidebar .sidebar-link').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.sidebar-link[data-view="${view}"]`).classList.add('active');

      // Update the content of the view
      if (view === 'dashboard') renderDashboard();
      if (view === 'products') renderAdminInventory();
      if (view === 'sales') renderAdminSales();
    }

    async function adminLogin() {
      const user = document.getElementById('adminUser').value;
      const pass = document.getElementById('adminPass').value;
      const pin = document.getElementById('adminOtp').value;
      const msgEl = document.getElementById('loginMsg');

      if (state.security.lockUntil > Date.now()) {
        msgEl.textContent = `Access locked. Try again in ${Math.ceil((state.security.lockUntil - Date.now()) / 60000)} minutes.`;
        return;
      }

      const userHash = await sha256(user);
      const passHash = await sha256(pass);
      const pinHash = pin ? await sha256(pin) : null;

      const userMatch = userHash === state.security.usernameHash;
      const passMatch = passHash === state.security.passwordHash;
      const pinMatch = !state.security.pinHash || pinHash === state.security.pinHash;

      if (userMatch && passMatch && pinMatch) {
        // Successful login
        state.security.failedCount = 0;
        state.security.lastLoginAt = nowISO();
        state.session.token = id();
        state.session.expiresAt = Date.now() + (30 * 60 * 1000); // 30 minutes session
        state.audit.unshift({ time: nowISO(), action: 'Admin Login Successful' });
        saveState();
        showAdminViews();
        switchView('dashboard');
        msgEl.textContent = '';
      } else {
        // Failed login
        state.security.failedCount++;
        if (state.security.failedCount >= 5) {
          state.security.lockUntil = Date.now() + (10 * 60 * 1000); // 10 minutes lock
          msgEl.textContent = '5 failed attempts. Account locked for 10 minutes.';
        } else {
          msgEl.textContent = `Invalid credentials. Attempt ${state.security.failedCount}/5.`;
        }
        state.audit.unshift({ time: nowISO(), action: 'Admin Login Failed' });
        saveState();
      }
    }

    function logout() {
      state.session.token = null;
      state.session.expiresAt = 0;
      state.audit.unshift({ time: nowISO(), action: 'Admin Logout' });
      saveState();
      showLoginGate('Successfully logged out.');
      closeAdmin();
    }

    // --- Dashboard
    function renderDashboard() {
        // Stats
        document.getElementById('statItems').textContent = state.items.length.toString();
        const totalSalesValue = state.sales.reduce((sum, sale) => sum + sale.total, 0);
        document.getElementById('statSales').textContent = formatUGX(totalSalesValue);
        document.getElementById('statRegs').textContent = state.regs.length.toString();
        document.getElementById('statLastLogin').textContent = state.security.lastLoginAt ? new Date(state.security.lastLoginAt).toLocaleString() : 'Never';

        // Audit Log
        const logHtml = state.audit.slice(0, 10).map(log =>
            `<div class="badge">${new Date(log.time).toLocaleTimeString()}</div><p class="muted" style="margin:0;">${log.action}</p>`
        ).join('');
        document.getElementById('auditLog').innerHTML = logHtml;
    }

    // --- Content Manager
    function addOrUpdateProduct() {
        const id = document.getElementById('prodName').dataset.editId || null;
        const name = document.getElementById('prodName').value;
        const price = parseInt(document.getElementById('prodPrice').value || 0);
        const category = document.getElementById('prodCategory').value;
        const mediaUrl = document.getElementById('prodMediaUrl').value;
        const desc = document.getElementById('prodDesc').value;

        if (!name) return alert('Name is required.');

        const newItem = {
            id: id || id(),
            name,
            price,
            category,
            mediaUrl,
            desc: desc, // Using 'desc' for all descriptions/excerpts/quotes for simplicity
        };

        if (id) {
            // Update
            const index = state.items.findIndex(i => i.id === id);
            if (index !== -1) {
                state.items[index] = newItem;
                state.audit.unshift({ time: nowISO(), action: `Updated item: ${name}` });
            }
        } else {
            // Add
            state.items.push(newItem);
            state.audit.unshift({ time: nowISO(), action: `Added new item: ${name}` });
        }

        saveState();
        mountUI();
        renderAdminInventory();
        resetProductForm();
    }

    function renderAdminInventory() {
        const inventoryGrid = document.getElementById('adminInventory');
        const itemsHtml = state.items.map(item => `
            <div class="card" style="cursor:pointer;" onclick="editProduct('${item.id}')">
                <div class="card-body">
                    <strong>${item.name}</strong> <span class="badge badge-primary">${item.category}</span>
                    <p class="muted" style="font-size:0.9rem;">${item.desc || ''}</p>
                    ${item.price > 0 ? `<span class="price">${formatUGX(item.price)}</span>` : ''}
                    <button class="btn btn-danger" style="float:right; padding:5px 10px;" onclick="event.stopPropagation(); deleteProduct('${item.id}')">&#10006;</button>
                </div>
            </div>
        `).join('');
        inventoryGrid.innerHTML = itemsHtml;
    }

    function editProduct(itemId) {
        const item = state.items.find(i => i.id === itemId);
        if (!item) return;

        document.getElementById('prodName').value = item.name;
        document.getElementById('prodName').dataset.editId = item.id;
        document.getElementById('prodPrice').value = item.price || 0;
        document.getElementById('prodCategory').value = item.category;
        document.getElementById('prodMediaUrl').value = item.mediaUrl || '';
        document.getElementById('prodDesc').value = item.desc || '';

        alert(`Editing item: ${item.name}`);
    }

    function deleteProduct(itemId) {
        if (!confirm('Are you sure you want to delete this item?')) return;
        const index = state.items.findIndex(i => i.id === itemId);
        if (index !== -1) {
            const name = state.items[index].name;
            state.items.splice(index, 1);
            state.audit.unshift({ time: nowISO(), action: `Deleted item: ${name}` });
            saveState();
            mountUI();
            renderAdminInventory();
        }
    }

    function resetProductForm() {
        document.getElementById('prodName').value = '';
        document.getElementById('prodName').dataset.editId = '';
        document.getElementById('prodPrice').value = '';
        document.getElementById('prodCategory').value = 'service';
        document.getElementById('prodMediaUrl').value = '';
        document.getElementById('prodDesc').value = '';
    }

    // --- Sales & Registrations
    function refreshSaleItems() {
        const select = document.getElementById('saleItem');
        const items = state.items.filter(i => i.price > 0 && i.category !== 'lesson');
        select.innerHTML = '<option value="" disabled selected>Select an item/service</option>' + items.map(i => `<option value="${i.id}">${i.name} (${formatUGX(i.price)})</option>`).join('');
    }

    function recordSale() {
        const itemId = document.getElementById('saleItem').value;
        const qty = parseInt(document.getElementById('saleQty').value || 1);

        const item = state.items.find(i => i.id === itemId);
        if (!item || !qty) return alert('Select an item and quantity.');

        const total = item.price * qty;
        const newSale = {
            id: id(),
            itemId: item.id,
            name: item.name,
            qty,
            unitPrice: item.price,
            total,
            time: nowISO()
        };
        state.sales.push(newSale);
        state.audit.unshift({ time: nowISO(), action: `Recorded sale: ${qty}x ${item.name}` });
        saveState();
        renderAdminSales();
        document.getElementById('saleQty').value = 1;
        document.getElementById('saleItem').value = '';
    }

    function renderAdminSales() {
        // Registrations
        document.getElementById('regsList').innerHTML = state.regs.map(r => `
            <div class="card" style="padding:10px;">
                <strong>${r.name}</strong> - ${r.course}
                <p class="muted" style="font-size:0.8rem; margin: 2px 0;">${r.email} | ${new Date(r.time).toLocaleDateString()}</p>
            </div>
        `).join('') || '<p class="muted">No new registrations.</p>';
        document.getElementById('regsStatus').textContent = `Total registrations: ${state.regs.length}`;

        // Sales
        document.getElementById('salesList').innerHTML = state.sales.slice(0, 10).map(s => `
            <div class="card" style="padding:10px;">
                <strong>${s.name} (${s.qty}x)</strong>
                <p class="success" style="float:right; margin:0;">${formatUGX(s.total)}</p>
                <p class="muted" style="font-size:0.8rem; margin: 2px 0;">${new Date(s.time).toLocaleDateString()}</p>
            </div>
        `).join('') || '<p class="muted">No sales recorded yet.</p>';

        const totalSales = state.sales.reduce((sum, sale) => sum + sale.total, 0);
        document.getElementById('salesTotals').textContent = `Lifetime Sales Value: ${formatUGX(totalSales)}`;
    }

    function clearSales() {
        if (!confirm('Are you sure you want to clear ALL sales and registration history?')) return;
        state.sales = [];
        state.regs = [];
        state.audit.unshift({ time: nowISO(), action: 'Cleared all sales and registrations.' });
        saveState();
        renderAdminSales();
    }

    // --- Calculator
    let calcRowCount = 0;
    function calcAddRow() {
        const tableBody = document.getElementById('calcTable').querySelector('tbody');
        const newRowId = `calc-row-${calcRowCount++}`;
        const newRow = tableBody.insertRow();
        newRow.id = newRowId;
        newRow.innerHTML = `
            <td><input class="input" placeholder="Item/Service" oninput="calcUpdateTotal()" /></td>
            <td><input type="number" class="input" value="0" min="0" oninput="calcUpdateTotal()" data-col="price" /></td>
            <td><input type="number" class="input" value="1" min="1" oninput="calcUpdateTotal()" data-col="qty" /></td>
            <td><input type="number" class="input" value="0" min="0" max="100" oninput="calcUpdateTotal()" data-col="disc" /></td>
            <td><input type="number" class="input" value="0" min="0" max="100" oninput="calcUpdateTotal()" data-col="tax" /></td>
            <td data-col="total">${formatUGX(0)}</td>
            <td><button class="btn btn-danger" onclick="calcRemoveRow('${newRowId}')">&#10006;</button></td>
        `;
        calcUpdateTotal();
    }

    function calcRemoveRow(rowId) {
        document.getElementById(rowId).remove();
        calcUpdateTotal();
    }

    function calcClear() {
        document.getElementById('calcTable').querySelector('tbody').innerHTML = '';
        calcRowCount = 0;
        calcUpdateTotal();
    }

    function calcUpdateTotal() {
        let subtotal = 0;
        let totalDisc = 0;
        let totalTax = 0;

        document.getElementById('calcTable').querySelectorAll('tbody tr').forEach(row => {
            const price = parseFloat(row.querySelector('[data-col="price"]').value) || 0;
            const qty = parseInt(row.querySelector('[data-col="qty"]').value) || 0;
            const discPercent = parseFloat(row.querySelector('[data-col="disc"]').value) / 100 || 0;
            const taxPercent = parseFloat(row.querySelector('[data-col="tax"]').value) / 100 || 0;

            const lineSubtotal = price * qty;
            const lineDiscount = lineSubtotal * discPercent;
            const lineTaxable = lineSubtotal - lineDiscount;
            const lineTax = lineTaxable * taxPercent;
            const lineTotal = lineTaxable + lineTax;

            subtotal += lineSubtotal;
            totalDisc += lineDiscount;
            totalTax += lineTax;

            row.querySelector('[data-col="total"]').textContent = formatUGX(lineTotal);
        });

        const grandTotal = subtotal - totalDisc + totalTax;

        document.getElementById('calcSubtotal').textContent = formatUGX(subtotal);
        document.getElementById('calcTotalDisc').textContent = formatUGX(totalDisc);
        document.getElementById('calcTotalTax').textContent = formatUGX(totalTax);
        document.getElementById('calcGrand').textContent = formatUGX(grandTotal);
    }

    // --- Security
    async function updateCredentials() {
        const newU = document.getElementById('newUsername').value;
        const newP = document.getElementById('newPassword').value;
        const newPin = document.getElementById('newPin').value;

        if (!newU || !newP) return alert('Username and Password are required.');

        state.security.usernameHash = await sha256(newU);
        state.security.passwordHash = await sha256(newP);
        state.security.pinHash = newPin ? await sha256(newPin) : null;
        state.audit.unshift({ time: nowISO(), action: 'Admin credentials updated.' });
        saveState();
        alert('Credentials updated successfully. Please re-login.');
        logout();
    }

    function wipeSession() {
        if (!confirm('Wipe Session will log you out and clear your session token. Continue?')) return;
        state.session.token = null;
        state.session.expiresAt = 0;
        state.security.failedCount = 0;
        state.security.lockUntil = 0;
        state.audit.unshift({ time: nowISO(), action: 'Session wiped.' });
        saveState();
        showLoginGate('Session wiped. Please login again.');
    }

    // --- Settings / Data Management
    function exportData() {
        const dataStr = JSON.stringify(state, null, 2);
        const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
        const exportFileDefaultName = 'jireh_media_house_data.json';
        let linkElement = document.createElement('a');
        linkElement.setAttribute('href', dataUri);
        linkElement.setAttribute('download', exportFileDefaultName);
        linkElement.click();
    }

    function importData() {
        const fileInput = document.getElementById('importFile');
        const file = fileInput.files[0];
        if (!file) return alert('Please select a JSON file to import.');

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importedState = JSON.parse(e.target.result);
                // Simple validation check
                if (importedState.items && importedState.security) {
                    state = { ...state, ...importedState };
                    state.audit.unshift({ time: nowISO(), action: 'Data imported successfully.' });
                    saveState();
                    mountUI();
                    alert('Data imported successfully! UI refreshed.');
                } else {
                    alert('Invalid file format. Does not contain required state keys.');
                }
            } catch (error) {
                alert('Error processing file: ' + error.message);
            }
        };
        reader.readAsText(file);
    }

    function clearAllData() {
        if (!confirm('DANGER: This will permanently delete ALL local data (inventory, sales, security settings, etc.). Are you absolutely sure?')) return;
        localStorage.removeItem(LS_KEY);
        // Reloads the page to reset the application state completely
        window.location.reload();
    }

    // --- Mount UI (Initialization)
    function mountUI(){
      // document.querySelector('.hero p').textContent = state.heroTagline; // Note: using hardcoded hero text in HTML for animation now
      renderServices();
      renderPortfolio();
      renderTestimonials();
      // renderBlog(); // Not implemented as a separate function, included in catalog
      // renderFaq(); // Not implemented as a separate function, included in content manager
      renderCatalog();
      renderLessons();
      refreshSaleItems();
    }

    // ---------- Init & Events ----------
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize after loading state
      loadState();
      ensureDefaultCredentials();

      // UI Mount
      mountUI();

      // Event Listeners
      document.getElementById('adminBtn').addEventListener('click', openAdmin);
      document.getElementById('footerAdmin').addEventListener('click', (e)=>{ e.preventDefault(); openAdmin(); });
      document.getElementById('modeToggle').addEventListener('click', toggleMode);

      document.querySelectorAll('.admin-sidebar .sidebar-link').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          if (!isSessionValid()){ showLoginGate('Session expired. Please login.'); return; }
          switchView(btn.dataset.view);
        });
      });

      // Catalog Search (live and robust)
      document.getElementById('searchInput').addEventListener('input', renderCatalog);
      document.getElementById('categorySelect').addEventListener('change', renderCatalog);
      document.getElementById('clearSearch').addEventListener('click', ()=>{
        document.getElementById('searchInput').value='';
        document.getElementById('categorySelect').value='';
        renderCatalog();
      });

      // Initialize Calculator with one row
      calcAddRow();

      // Setup eye-catching scroll animations
      setupScrollReveal();
    });

    // Theme Toggle
    function toggleMode(){
      const body = document.body;
      body.classList.toggle('light');
      body.classList.toggle('dark');
      saveState();
    }

  </script>
</body>
</html>